## -----------------------------------------------------------------------------------------------------------
library(tidyverse)
library(rvest)
library(RSelenium)


## -----------------------------------------------------------------------------------------------------------


## -----------------------------------------------------------------------------------------------------------
shows <- list()


## ----navigate-----------------------------------------------------------------------------------------------


## -----------------------------------------------------------------------------------------------------------
# my_url <- "https://www.flashscore.com/football/albania/superliga/"
# remDr$navigate(my_url)
# remDr$getAllCookies()


## ----page-source--------------------------------------------------------------------------------------------
my_html <- remDr$getPageSource()[[1]][1]
# my_html


## -----------------------------------------------------------------------------------------------------------
fname <- str_c("h", Sys.time(), ".rds")
fname %>% str_replace_all(" ", "_") -> fname
write_rds(my_html, fname)


## -----------------------------------------------------------------------------------------------------------


## -----------------------------------------------------------------------------------------------------------
v <- list.files(pattern = "^h20.*\\.rds")
tail(v)
``

----
i <- 2
j <- 1
vv <- rev(sort(v))
make_game_df(vv[i])

m_0 <- make_game_df(vv[i])
m_1 <- make_game_df(vv[j])


## -----------------------------------------------------------------------------------------------------------
nrow(m_0) ; nrow(m_1)


## -----------------------------------------------------------------------------------------------------------
dones <- c("FT", "AET", "AP", "Postp.", "Canc.")
qq <- "? - ?"
m_0 %>% left_join(m_1, by = "key") %>% 
  mutate(display = case_when(
    score.x == qq & score.y == qq                ~ 0, # not started yet
    status.x %in% dones & status.y %in% dones    ~ 0, # was done
    !(status.x %in% dones) & status.y %in% dones ~ 1, # just finished
    score.x == qq & score.y != qq                ~ 1, # just started
    score.x != score.y                           ~ 1,  # goal
    TRUE                                         ~ 0, # nothing
  )) %>% 
  filter(display == 1) %>% 
  mutate(score = str_c(score.y, "  (", score.x, ")")) %>% 
  select(status = status.y, home = home.y, score, away = away.y) %>% 
  arrange(home) -> d_now
nrow(d_now)


## -----------------------------------------------------------------------------------------------------------
latest <- str_c("latest ", Sys.time())
d_now
shows$latest <- d_now
View(shows$latest, latest)


## -----------------------------------------------------------------------------------------------------------
m_1 %>% filter(!(status %in% dones)) %>% 
  filter(score != qq)


## -----------------------------------------------------------------------------------------------------------
m_1 %>% filter(score != qq) %>% 
  arrange(home) -> xxx
if (nrow(d_now)==0) {
  xxx %>% View("past")
}
xxx

